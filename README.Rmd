---
output:
  github_document:
    html_preview: false
---

# `damr` [![Travis-CI Build Status](https://travis-ci.org/rethomics/damr.svg?branch=master)](https://travis-ci.org/rethomics/damr)

<!-- [![AppVeyor Build Status](https://ci.appveyor.com/api/projects/status/github/tidyverse/hms?branch=master&svg=true)](https://ci.appveyor.com/project/tidyverse/hms)  -->

<!-- [![Coverage Status](https://img.shields.io/codecov/c/github/tidyverse/hms/master.svg)](https://codecov.io/github/tidyverse/hms?branch=master) [![CRAN_Status_Badge](http://www.r-pkg.org/badges/version/hms)](https://cran.r-project.org/package=hms) -->

`damr` is part of the [rethomics framework](todo.html).
This README is a short explanation of the basics of `damr`.
A [comprehensive documentation](todo.html) of rethomics is also available.

## Drosophila Activity Monitor
todo, say something about what DAMS is
 


## Installation

```{r,eval=F}
library(devtools)
install_github("rethomics/behavr")
install_github("rethomics/damr")
```

## A closer look at a query

When running experiments with DAM2, you will end up with a result directory (folder) that contains one file per monitor. Each file stores the data for up to 32 animals at once.
Each animal may have a different set of metadata (e.g. sex, genotype, treatment,...).

In the [rethomics framework](todo.html), the priviledged way to load data is to write a query.
That is, a table where each row is an animal, and each condition (metadata) is a column.
Read more about queries [here](todo2.html)

In practice, you would write your query in excel or similar software, save it as a CSV, and then load it with `read.csv()`, or `fread` (in the `data.table` package).

`damr` comes with a couple of toy queries and DAM2 files we can play with.

```{r}
library(behavr)
data("two_files_query")
print(two_files_query)
```

Lets stop for a second and look at how our example query is formated.
`two_files_query` is a query with 64 animals in two files (`M064.txt` and `M014.txt`).
As you can see, each animal is defined by:

* a `file` which is the name of the file (monitor) this animal was recorded in
* a `start_datetime`, when your experiment starts (t0 and ZT0)
* a `stop_time`, when your experiment stops
* a `region_id`, in which channel your animal is (1:32)
* condition, genotype, ... that are biologically relevant **meta variables**

Importanlty, the name of the first four columns is *decided for you*, but the next (condition, genotype,...) are not. In fact, *you can define yourself any number and type* (numbers, dates,...) of meta variables!
In fact, in the [rethomics framework](todo.html), you will probably analyse hundreads of animals, from several replicates, in one go from the same query.

```{r}
library(damr)
data("two_files_query")
print(two_files_query)
```


## Importing DAM2 data into R

In real life, you will have your data in a folder (i.e. directory) such as `C:/A/random/folder`.
But this would be different for each user.
So that the example works for everyone, we can use `damr_example_dir()` 
to locate the folder where I put some data for you.

```{r}
result_dir <- damr_example_dir()
print(result_dir)
```

Then, the magic happens when we use the `query_dam2()` function:

```{r}
dt <- query_dam2(result_dir, two_files_query)
print(dt)
```
`dt`, is a [behavr table](https://github.com/rethomics/behavr).

We can have a look at the metadata:

```{r}
dt[meta=T]
```



## Going further

* [behavr](https://github.com/rethomics/behavr) -- to manipulate the data (create new variable/meta-variables)
* [ggetho](https://github.com/rethomics/ggetho) -- to plot visualise the data
* [sleepr](https://github.com/rethomics/sleepr) -- to perform sleep and circadian rythm analysis

